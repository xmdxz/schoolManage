<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
        PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
        "http://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="com.SchoolManage.dao.TalkMemberDao">
    <select id="findAll" resultType="com.SchoolManage.pojo.TalkMember">
        select *,
        (select count(*)
        from talkmember talkmember2
        where talkmember2.code = talkmember1.code
        ) as num
        from talkmember talkmember1
        where talkmember1.type = #{type}
        <if test="comy != null and comy != '' ">
            and find_in_set(#{comy},talkmember1.comy)
        </if>
        limit #{startPage},#{num}
    </select>

    <select id="findAllCount" resultType="int">
        select count(*)
        from talkmember
        where type = #{type}
        <if test="comy != null and comy != '' ">
            and find_in_set(#{comy},comy)
        </if>
    </select>

    <update id="updateData">
        update talkmember
        set type         = #{talkMember.type},
            clazz        = #{talkMember.clazz},
            code         = #{talkMember.code},
            name         = #{talkMember.name},
            status       = #{talkMember.status},
            own_phone    = #{param1.own_phone},
            family_phone = #{talkMember.family_phone},
            solution     = #{talkMember.solution},
            remarks      = #{talkMember.remarks},
            comy       =   #{talkMember.comy},
            comy       =   #{talkMember.talk_date}
        where id = #{talkMember.id}
    </update>

    <insert id="insertData">
        insert into talkmember(type, clazz, code, name, status, own_phone,
                               family_phone,  solution, remarks,comy,talk_date)
        values (#{talkMember.type}, #{talkMember.clazz}, #{talkMember.code}, #{talkMember.name},
                #{talkMember.status},#{talkMember.own_phone}, #{talkMember.family_phone}, #{talkMember.solution},
                #{talkMember.remarks}, #{talkMember.comy},#{talkMember.talk_date})
    </insert>

    <insert id="insertDatas">
        insert into talkmember(type, clazz, code, name, status, own_phone,
        family_phone,  solution, remarks,comy,talk_date)
        values
        <foreach collection="list" item="item" separator=",">
            (#{item.type},#{item.clazz},#{item.code},#{item.name},#{item.status},#{item.own_phone},#{item.family_phone},#{item.solution},#{item.remarks},#{item.comy},#{item.talk_date})
        </foreach>
    </insert>

    <delete id="deleteData">
        delete
        from talkmember
        where id = #{id}
    </delete>
    <select id="findById" resultType="com.SchoolManage.pojo.TalkMember">
        select *,
         (select count(*)
        from talkmember talkmember2
        where talkmember2.code = talkmember1.code
        ) as num
        from talkmember talkmember1
        where talkmember1.id = #{id}
    </select>

    <select id="findByCodeAndType" resultType="com.SchoolManage.pojo.TalkMember">
        select *,
        (select count(*)
        from talkmember talkmember2
        where talkmember2.code = talkmember1.code
        ) as num
        from talkmember talkmember1
        where talkmember1.type = #{type}
          and talkmember1.code = #{code}
        <if test="comy != null and comy != '' ">
            and find_in_set(#{comy},talkmember1.comy)
        </if>
        limit #{startPage},#{num}
    </select>

    <select id="findByCode" resultType="com.SchoolManage.pojo.TalkMember">
        select *,
        (select count(*)
        from talkmember talkmember2
        where talkmember2.code = talkmember1.code
        ) as num
        from talkmember talkmember1
        where talkmember1.code = #{code}
        <if test="comy != null and comy != '' ">
            and find_in_set(#{comy},talkmember1.comy)
        </if>
        limit #{startPage},#{num}
    </select>

    <select id="findByCodeAndTypeCount" resultType="int">
        select count(*)
        from talkmember
        where type = #{type}
          and code = #{code}
        <if test="comy != null and comy != '' ">
            and find_in_set(#{comy},comy)
        </if>
    </select>

    <select id="findByCodeCount" resultType="int">
        select count(*)
        from talkmember
        where code = #{code}
        <if test="comy != null and comy != '' ">
            and find_in_set(#{comy},comy)
        </if>
    </select>

    <select id="findByName" resultType="com.SchoolManage.pojo.TalkMember">
        select *,
        (select count(*)
        from talkmember talkmember2
        where talkmember2.code = talkmember1.code
        ) as num
        from talkmember talkmember1
        where talkmember1.type = #{type}
          and talkmember1.name like concat("%", #{name}, "%")
        <if test="comy != null and comy != '' ">
            and find_in_set(#{comy},talkmember1.comy)
        </if>
        limit #{startPage},#{num}
    </select>
    <select id="findBytype" resultType="com.SchoolManage.pojo.TalkMember">
        select *,
        (select count(*)
        from talkmember talkmember2
        where talkmember2.code = talkmember1.code
        ) as num
        from talkmember talkmember1
        where talkmember1.type = #{type}
        <if test="comy != null and comy != '' ">
            and find_in_set(#{comy},talkmember1.comy)
        </if>
        limit #{startPage},#{num}
    </select>
    <select id="findBytypeCount" resultType="int">
        select count(*)
        from talkmember
        where type = #{type}
        <if test="comy != null and comy != '' ">
            and find_in_set(#{comy},comy)
        </if>
    </select>
    <select id="findByNameCount" resultType="int">
        select count(*)
        from talkmember
        where type = #{type}
          and name like concat("%", #{name}, "%")
        <if test="comy != null and comy != '' ">
            and find_in_set(#{comy},comy)
        </if>
    </select>
</mapper>
